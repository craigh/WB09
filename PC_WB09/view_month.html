{pnpageaddvar name="stylesheet" value="modules/PostCalendar/pntemplates/default/style/style.css"}

{ if $PRINT_VIEW != 1 }
{ include file="default/navigation.html" }
{ /if }
<table width="100%" border="0" cellpadding="5" cellspacing="0" class="monthheader">
	<tr align="center">
    	<td nowrap="nowrap" width="100%" align="center" valign="top" class="monthheader">
			<a href="{ $PREV_MONTH_URL }">&lt;&lt;</a>
    		{ $DATE|pc_date_format:'%B %Y'}
			<a href="{ $NEXT_MONTH_URL }">&gt;&gt;</a>
		</td>
	</tr>
</table>
<table width="100%" border="0" cellpadding="1" cellspacing="0" class="calcontainer"><tr><td>
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        { foreach from=$S_LONG_DAY_NAMES item=day }
        <td width="14%" align="center" valign="middle" class="daynames">{ $day }</td>
        { /foreach }
    </tr>
    { * CREATE THE CALENDAR * }
	{ foreach name=weeks item=days from=$CAL_FORMAT }
	<tr>
		{ foreach name=days item=date from=$days }
		{ if $date == $TODAY_DATE }
			{ assign var="stylesheet" value="monthtoday" }
		{ elseif ($date < $MONTH_START_DATE || $date > $MONTH_END_DATE) }
			{ assign var="stylesheet" value="monthoff" }
		{ else }
			{ assign var="stylesheet" value="monthon" }
		{ /if }
		<td height="75" align="left" valign="top" class="{ $stylesheet }"
		    onmouseover="this.style.backgroundColor='white'"
			onmouseout="this.style.backgroundColor=''"
			onclick="javascript:location.href='{ pc_url action=day date=$date }';">
			<table width="100%" border="0" cellpadding="0" cellspacing="0">
				<tr>
					<td align="left" valign="top"><a 
						href="{ pc_url action=day date=$date }">{ $date|date_format:"%d" }</a>
					{ if $smarty.foreach.days.iteration == 1 }
					<a href="{ pc_url action=week date=$date }">[week]</a>
					{ /if }
					</td>
					<td align="right" valign="top">
						{ if $ACCESS_ADD eq true }
						<a href="{ pc_url action=submit date=$date }"><img 
                 		src="{ $TPL_IMAGE_PATH }/new.gif" width="10" height="10" border="0" /></a>
						{ /if }
					</td>
				</tr>
				<tr>
					<td colspan="2" valign="top" align="left">
					{ *sort the events by category so we can make it pretty* }
					{ pc_sort_events var="S_EVENTS" sort="time" order="asc" value=$A_EVENTS }
					{ assign var="oldCat" value="" }
					{ if isset($S_EVENTS) }
					{ foreach name=events item=event from=$S_EVENTS.$date }
						{ assign var="cCat" value=$event.catname }
						{ if $oldCat != $cCat }
							{ if $smarty.foreach.events.first != true }
								</div>
							{ /if }
							<div style="padding: 1px; background-color: { $event.catcolor };">
								{ if $event.meeting_id }<img src="{ $TPL_IMAGE_PATH }/meeting.gif" alt="Meeting" align="absmiddle" title="Meeting" border="0"" />{ /if }{ $event.catname }
							</div>
							<div style="padding: 2px; border:solid 1px { $event.catcolor };">
						{ /if }
						
						{ * Here we determine if the event is an 
							all day event or a timed event
							and determine how to display the time * }
						{ if $event.alldayevent != true }
							{ if $24HOUR_TIME }
								{ assign var="timestamp" value=$event.startTime|date_format:'%H:%M'}
							{ else }
								{ assign var="timestamp" value=$event.startTime|date_format:'%l:%M %p'}
							{ /if }
							{ *assign var="title" value=$event.title|truncate:15:"...":true* }
							{ assign var="title" value=$event.title|strip_tags }
						{ else }
							{ assign var="timestamp" value="" }
							{ *assign var="title" value=$event.title|truncate:30:"...":true* }
							{ assign var="title" value=$event.title|strip_tags }
						{ /if }
						
						{ $event.uname } <!-- // V4B SB Inseted Username to get a better overview -->
						{ assign var="desc" value=$event.hometext|truncate:255:"..." }
						{ * Here we start the actual display of the event * }
						<a style="font-size: 7pt; text-decoration: none;" href="{ pc_url action=detail eid=$event.eid date=$date }" { pc_popup delay="500" bgcolor="$event[catcolor]" timeout="3600" caption="$timestamp $event[title]" text="$desc" }> { $timestamp } { $title|pnvarprephtmldisplay }</a><br />
						{ assign var="oldCat" value=$event.catname }
						{ if $smarty.foreach.events.last }
							{ * we need to close out the <div> tag * }
								</div>
						{ /if }
					{ /foreach }
					{ /if }
					</td>
				</tr>
			</table>			
		</td>
		{ /foreach }
	</tr>
	{ /foreach }
</table>
</td></tr></table>
{ if $PRINT_VIEW != 1 }
<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td align="right">
            <a href="{ pc_url action="month" print="true" }">Print</a>
        </td>
    </tr>
</table>
{ /if }
{ include file="default/footer.html" }
